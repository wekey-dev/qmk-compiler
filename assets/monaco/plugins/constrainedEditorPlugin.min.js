(()=>{"use strict";var e={d:(n,t)=>{for(var r in t)e.o(t,r)&&!e.o(n,r)&&Object.defineProperty(n,r,{enumerable:!0,get:t[r]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)},n={};e.d(n,{default:()=>s});const t=function(e){const n=document.createElement("div"),t=e.editor.create(n),r=t.constructor.name,o=t.getModel().constructor.name;return{isInstanceValid:function(e){return e.constructor.name===r},isModelValid:function(e){return e.constructor.name===o},isRangesValid:function(e){return!!Array.isArray(e)&&e.every((function(e){return!("object"!=typeof e||"Object"!==e.constructor.name||!e.hasOwnProperty("range")||!Array.isArray(e.range)||4!==e.range.length||!e.range.every((e=>e>0&&parseInt(e)===e))||e.hasOwnProperty("allowMultiline")&&"boolean"!=typeof e.allowMultiline||e.hasOwnProperty("label")&&"string"!=typeof e.label||e.hasOwnProperty("validate")&&"function"!=typeof e.validate)}))}}},r=function(e,n,t){return"The value for the "+n+" should be of type "+(Array.isArray(e)?e.join(" | "):e)+". "+(t||"")},o=function(){const e=function(e,n){return"object"!=typeof e||null===e?this.freeze?Object.freeze(e):e:e instanceof Date?this.freeze?Object.freeze(new Date(e)):new Date(e):n.call(this,e)},n=function(n,t){const r=Object.keys(n),o=new Array(r.length);for(let i=0;i<r.length;i++)o[r[i]]=e.call(this,n[r[i]],t);return o},t=function(r){return e.call(this,r,(function(r){if(Array.isArray(r))return n.call(this,r,t);const o={};for(let n in r)(this.withProto||!1!==Object.hasOwnProperty.call(r,n))&&(o[n]=e.call(this,r[n],t));return o}))},r=function(){const e=function(e){this[e]=["withProto","freeze"].reduce(function(n,t){return(n[t]=e>=this[t])&&(e-=this[t]),n}.bind(this),{})},n=Object.create(Object.defineProperties({},{withProto:{value:1},freeze:{value:2}}));for(let t=0;t<=3;t++)e.call(n,t);return n}(),o={withProto:t.bind(r[1]),andFreeze:t.bind(r[2]),withProtoAndFreeze:t.bind(r[3])},i=t.bind(r[0]);for(let e in o)Object.defineProperty(i,e,{enumerable:!1,writable:!1,configurable:!1,value:o[e]});return i}(),i="editableArea--single-line",a="editableArea--multi-line",s=function(e){if(void 0===e)throw new Error(["Please pass the monaco global variable into function as","(eg:)constrainedEditor({ range : monaco.range });"].join("\n"));const n=function(e){const n=e.getModel();if(n._isCursorAtCheckPoint){const t=e.getSelections(),r=t.map((function(e){return{lineNumber:e.positionLineNumber,column:e.positionColumn}}));n._isCursorAtCheckPoint(r),n._currentCursorPositions=t}},s={},{isInstanceValid:l,isModelValid:c,isRangesValid:d}=t(e),u={_listener:null,_editorInstance:null,_uriRestrictionMap:s,_injectedResources:e},g=Object.create(u),f={initializeIn:function(e){if(l(e)){let t=e.getDomNode();return u._listener=n.bind(g,e),u._editorInstance=e,u._editorInstance._isInDevMode=!1,t.addEventListener("keydown",u._listener,!0),u._onChangeModelDisposable=e.onDidChangeModel((function(){t&&t.removeEventListener("keydown",u._listener,!0);const n=e.getDomNode();n&&n.addEventListener("keydown",u._listener,!0),t=n})),!0}throw new Error(r("ICodeEditor","editorInstance","This type interface can be found in monaco editor documentation"))},addRestrictionsTo:function(n,t){if(c(n)){if(d(t)){const r=function(e,n,t){const r=t.Range,s=function(e,n){const t=e.range,r=n.range;if(t[0]<r[0]||t[0]===r[0]&&t[3]<r[1])return-1};let l=o(n).sort(s);const c=function(n){const t=e.getValue();n.forEach((function(e,n){const o=function(e,n){const t=n.split("\n"),r=t.length,o=[];return e.forEach((function(e,n){if(0===e)throw new Error("Range values cannot be zero");switch(n){case 0:if(e<0)throw new Error("Start Line of Range cannot be negative");if(e>r)throw new Error("Provided Start Line("+e+") is out of bounds. Max Lines in content is "+r);o[n]=e;break;case 1:{let r=e;const i=o[0],a=t[i-1].length;if(r<0){if(r=a-Math.abs(r),r<0)throw new Error("Provided Start Column("+e+") is out of bounds. Max Column in line "+i+" is "+a)}else if(r>a+1)throw new Error("Provided Start Column("+e+") is out of bounds. Max Column in line "+i+" is "+a);o[n]=r}break;case 2:{let t=e;if(t<0){if(t=r-Math.abs(e),t<0)throw new Error("Provided End Line("+e+") is out of bounds. Max Lines in content is "+r);t<o[0]&&console.warn("Provided End Line("+e+") is less than the start Line, the Restriction may not behave as expected")}else if(e>r)throw new Error("Provided End Line("+e+") is out of bounds. Max Lines in content is "+r);o[n]=t}break;case 3:{let r=e;const i=o[2],a=t[i-1].length;if(r<0){if(r=a-Math.abs(r),r<0)throw new Error("Provided End Column("+e+") is out of bounds. Max Column in line "+i+" is "+a)}else if(r>a+1)throw new Error("Provided Start Column("+e+") is out of bounds. Max Column in line "+i+" is "+a);o[n]=r}}})),o}(e.range,t),i=o[0],a=o[1],s=o[2],l=o[3];e._originalRange=o.slice(),e.range=new r(i,a,s,l),e.index=n,e.allowMultiline||(e.allowMultiline=r.spansMultipleLines(e.range)),e.label||(e.label=`[${i},${a} -> ${s}${l}]`)}))},d=function(){return l.reduce((function(e,n){return e[n.label]={allowMultiline:n.allowMultiline||!1,index:n.index,range:Object.assign({},n.range),originalRange:n._originalRange.slice()},e}),{})},u=function(){return Promise.resolve().then((function(){e.editInRestrictedArea=!0,e.undo(),e.editInRestrictedArea=!1,e._hasHighlight&&e._oldDecorationsSource&&(e.deltaDecorations(e._oldDecorations,e._oldDecorationsSource),e._oldDecorationsSource.forEach((function(n){n.range=e.getDecorationRange(n.id)})))}))},g=function(n,t,r,o,i,a){let s=t.endLineNumber,c=t.endColumn;n.prevRange=t,n.range=t.setEndPosition(r,o);const d=l.length;let u=i.length;const g=o-c,f=r-s,b=e._currentCursorPositions||[],h=b.length;if(u!==h&&(i=i.filter((function(e){const n=e.range;for(let e=0;e<h;e++){const t=b[e];if(n.startLineNumber===t.startLineNumber&&n.endLineNumber===t.endLineNumber&&n.startColumn===t.startColumn&&n.endColumn===t.endColumn)return!0}return!1})),u=i.length),0!==f){for(let e=n.index+1;e<d;e++){const n=l[e],t=n.range;s===t.startLineNumber&&(t.startColumn+=g),s===t.endLineNumber&&(t.endColumn+=g),t.startLineNumber+=f,t.endLineNumber+=f,n.range=t}for(let e=a+1;e<u;e++){const n=i[e],t=n.range,r=t.toString(),o=rangeMap[r];delete rangeMap[r],s===t.startLineNumber&&(t.startColumn+=g),s===t.endLineNumber&&(t.endColumn+=g),t.startLineNumber+=f,t.endLineNumber+=f,n.range=t,rangeMap[t.toString()]=o}}else{for(let e=n.index+1;e<d;e++){const n=l[e],t=n.range;if(t.startLineNumber>s)break;t.startColumn+=g,t.endColumn+=g,n.range=t}for(let e=a+1;e<u;e++){const n=i[e],t=n.range,r=t.toString(),o=rangeMap[r];if(delete rangeMap[r],t.startLineNumber>s){rangeMap[t.toString()]=o;break}t.startColumn+=g,t.endColumn+=g,n.range=t,rangeMap[t.toString()]=o}}},f=function(){console.debug("handler for unhandled promise rejection")},b=function(e){for(let n in e){const t=e[n];t.range=t.prevRange}},h=function(e,n){return!e.allowMultiline&&n.includes("\n")},m=function(e,n,t){return e.validate&&!e.validate(n,t,e.lastInfo)},p={_isRestrictedModel:!0,_isRestrictedValueValid:!0,_editableRangeChangeListener:[],_isCursorAtCheckPoint:function(n){n.some((function(n){const t=n.lineNumber,r=n.column,o=l.length;for(let n=0;n<o;n++){const o=l[n].range;if(o.startLineNumber===t&&o.startColumn===r||o.endLineNumber===t&&o.endColumn===r)return e.pushStackElement(),!0}}))},_currentCursorPositions:[]};c(l),e._hasHighlight=!1,p._restrictionChangeListener=e.onDidChangeContent((function(n){const t=n.isUndoing;if(e._isRestrictedValueValid=!0,t&&e.editInRestrictedArea)e.editInRestrictedArea&&(e._isRestrictedValueValid=!1);else{const t=n.changes.sort(s),r={},o=l.length;if(t.every((function(e){const n=e.range,t=n.toString();r[t]=null;for(let i=0;i<o;i++){const o=l[i];if(o.range.containsRange(n))return!h(o,e.text)&&(r[t]=o,!0)}return!1}))){t.forEach((function(e,n){const o=e.range,i=r[o.toString()],a=i.range,s=e.text||"",l=(s.match(/\n/g)||[]).length,c=s.split(/\n/g).pop().length,d=o.endLineNumber-o.startLineNumber,u=o.endColumn-o.startColumn;let f=a.endLineNumber,b=a.endColumn,h=0;a.endLineNumber!==o.startLineNumber&&a.endLineNumber!==o.endLineNumber||(h+=a.endColumn-o.startColumn+1);const m=function(e,n){const t={},r=e.range;return""===e.text?t.isDeletion=!0:r.startLineNumber===r.endLineNumber&&r.startColumn===r.endColumn?t.isAddition=!0:t.isReplacement=!0,t.startLineOfRange=r.startLineNumber===n.startLineNumber,t.startColumnOfRange=r.startColumn===n.startColumn,t.endLineOfRange=r.endLineNumber===n.endLineNumber,t.endColumnOfRange=r.endColumn===n.endColumn,t.middleLineOfRange=!t.startLineOfRange&&!t.endLineOfRange,n.startLineNumber===n.endLineNumber?t.rangeIsSingleLine=!0:t.rangeIsMultiLine=!0,t}(e,a);i.lastInfo=m,(m.isAddition||m.isReplacement)&&(m.rangeIsSingleLine&&(0===l?b+=c:(f+=l,m.startColumnOfRange?b+=c:b=m.endColumnOfRange?c+1:c+h)),m.rangeIsMultiLine&&(f+=l,m.endLineOfRange&&(0===l?b+=c:b=h+c))),(m.isDeletion||m.isReplacement)&&(m.rangeIsSingleLine&&(b-=u),m.rangeIsMultiLine&&(m.endLineOfRange?(f-=d,b-=u):f-=d)),g(i,a,f,b,t,n)}));const n=e.getValueInEditableRanges(),o={};for(let e in r){const t=r[e],i=t.range,a=t.label||i.toString(),s=n[a];if(m(t,s,i))return b(r),void u();o[a]=s}e._hasHighlight&&e._oldDecorationsSource.forEach((function(n){n.range=e.getDecorationRange(n.id)})),function(n,t){const r=d();e._editableRangeChangeListener.forEach((function(o){o.call(e,n,t,r)}))}(o,n)}else u()}})),window.onerror=f;const _={editInRestrictedArea:!1,getCurrentEditableRanges:d,getValueInEditableRanges:function(){return l.reduce((function(n,t){return n[t.label]=e.getValueInRange(t.range),n}),{})},disposeRestrictions:function(){return e._restrictionChangeListener.dispose(),window.removeEventListener("error",f),delete e.editInRestrictedArea,delete e.disposeRestrictions,delete e.getValueInEditableRanges,delete e.updateValueInEditableRanges,delete e.updateRestrictions,delete e.getCurrentEditableRanges,delete e.toggleHighlightOfEditableAreas,delete e._hasHighlight,delete e._isRestrictedModel,delete e._isCursorAtCheckPoint,delete e._currentCursorPositions,delete e._editableRangeChangeListener,delete e._restrictionChangeListener,delete e._oldDecorations,delete e._oldDecorationsSource,e},onDidChangeContentInEditableRange:function(n){"function"==typeof n&&e._editableRangeChangeListener.push(n)},updateRestrictions:function(e){l=o(e).sort(s),c(l)},updateValueInEditableRanges:function(n,t){if("object"!=typeof n||Array.isArray(n))throw new Error("Value must be an object");{t="boolean"==typeof t&&t;const r=l.reduce((function(e,n){return n.label&&(e[n.label]=n),e}),{});for(let i in n){const a=r[i];if(a){const r=n[i];if(h(a,r))throw new Error("Multiline change is not allowed for "+i);const s=o(a.range);if(s.endLine=s.startLine+r.split("\n").length-1,s.endColumn=r.split("\n").pop().length,m(a,r,s))throw new Error("Change is invalidated by validate function of "+i);e.applyEdits([{forceMoveMarkers:!!t,range:a.range,text:r}])}else console.error("No restriction found for "+i)}}},toggleHighlightOfEditableAreas:function(){if(e._hasHighlight)e.deltaDecorations(e._oldDecorations,[]),delete e._oldDecorations,delete e._oldDecorationsSource,e._hasHighlight=!1;else{const n=l.map((function(e){const n={range:e.range,options:{className:e.allowMultiline?a:i}};return e.label&&(n.hoverMessage=e.label),n}));e._oldDecorations=e.deltaDecorations([],n),e._oldDecorationsSource=n.map((function(n,t){return Object.assign({},n,{id:e._oldDecorations[t]})})),e._hasHighlight=!0}}};for(let n in p)Object.defineProperty(e,n,{enumerable:!1,configurable:!0,writable:!0,value:p[n]});for(let n in _)Object.defineProperty(e,n,{enumerable:!1,configurable:!0,writable:!0,value:_[n]});return e}(n,t,e,u._editorInstance);return s[r.uri.toString()]=r,r}throw new Error(r("Array<RangeRestrictionObject>","ranges","Please refer constrained editor documentation for proper structure"))}throw new Error(r("ICodeEditor","editorInstance","This type interface can be found in monaco editor documentation"))},removeRestrictionsIn:function(e){if(c(e)){const n=e.uri.toString(),t=s[n];return t?t.disposeRestrictions():(console.warn("Current Model is not a restricted Model"),!1)}throw new Error(r("ICodeEditor","editorInstance","This type interface can be found in monaco editor documentation"))},disposeConstrainer:function(){if(u._editorInstance){const e=u._editorInstance.getDomNode();e&&e.removeEventListener("keydown",u._listener),u._onChangeModelDisposable&&u._onChangeModelDisposable.dispose(),delete u._listener,delete u._editorInstance._isInDevMode,delete u._editorInstance._devModeAction,delete u._editorInstance,delete u._onChangeModelDisposable;for(let e in s)delete s[e];return!0}return!1},toggleDevMode:function(){u._editorInstance._isInDevMode?(u._editorInstance._isInDevMode=!1,u._editorInstance._devModeAction.dispose(),delete u._editorInstance._devModeAction):(u._editorInstance._isInDevMode=!0,u._editorInstance._devModeAction=u._editorInstance.addAction({id:"showRange",label:"Show Range in console",contextMenuGroupId:"navigation",contextMenuOrder:1.5,run:function(e){const n=e.getSelections().reduce((function(e,{startLineNumber:n,endLineNumber:t,startColumn:r,endColumn:o}){return e.push("range : "+JSON.stringify([n,r,t,o])),e}),[]).join("\n");console.log("Selected Ranges : \n"+JSON.stringify(n,null,2))}}))}};for(let e in f)Object.defineProperty(g,e,{enumerable:!1,writable:!1,configurable:!1,value:f[e]});return Object.freeze(g)};window.constrainedEditor=n.default})();
//# sourceMappingURL=constrainedEditorPlugin.min.js.map